---
Owner: Arthur Schwan
Last-Reviewed: 2025-09-17
Next-Review: 2025-12-01
Version: 1.0
Status: Approved
---
# C4 Architekturmodell

## Zweck & Scope
Dieses Dokument beschreibt, wie die Plattform ueber C4-Modellierung dokumentiert wird. Ziel ist ein konsistentes Architektur-Backbone fuer Entwickler, Betriebs- und Managementteams.

## Enterprise-Anforderungen
- Aktuelle System-, Container-, Component- und Code-Level Sichten.
- Automation via Structurizr DSL und GitOps (Build/Publish in CI).
- Nachvollziehbare Links zu ADRs, Roadmap und Compliance Artefakten.
- Versionierte Diagramme mit Review und Approval.
- Integration mit Incident Reviews und Onboarding.

## Technologie-Stack
- Structurizr DSL Repository (`architecture/structurizr.dsl`).
- Build Pipeline (Node/Java) zur Generierung von PNG/SVG/HTML.
- Publish Workflow in Docs Portal (`docs/md.html?path=architecture/c4.md`).
- Diagram-as-Code Linting (Structurizr CLI, c4lint).
- Sync mit ADRs via metadata (tags, links).

## Architektur & Betrieb
Diagramme entstehen aus DSL-Dateien, die in Git verwaltet werden. CI generiert Artefakte, speichert sie als GitHub Pages Assets. Updates triggern Review (Architecture Board). Diagramme referenzieren Services (Gateway, Orchestrator, Redis, Neon, LLM Router, Monitoring) und Data Flows. Health Monitor stellt sicher, dass Artefakte aktuell sind.

## Schnittstellen & Vertraege
- Structurizr CLI (`structurizr.sh push/pull`) mit API Key/Secret.
- Dokumentenlinks zu ADRs, Risk Register, Compliance.
- Diagramm Export fuer CAB (PDF), Onboarding (HTML), Incident Analysis.
- Versionierung via Git Tags, Release Notes.

## Deliverables
- Vollstaendiges C4 Paket (Context, Container, Component, Dynamic Views).
- Generierungsskripte (npm/gradle) mit README.
- Review-Template fuer Architecture Board.
- Publishing Pipeline (GitHub Actions/ADO) inkl. Link Checker.

## Asset Bundle & Governance
- **System Context**: `docs/architecture/assets/system-context.png` (Structurizr View `SystemContext`, Owner Architecture Guild).
- **Container View**: `docs/architecture/assets/container.png` (Gateway, Orchestrator, Monitoring, Data Layer).
- **Component View (Gateway)**: `docs/architecture/assets/gateway-components.png` (AuthN, Rate Limit, Webhooks, LLM Router).
- **Dynamic View (Draft PR Flow)**: `docs/architecture/assets/draft-pr-sequence.png` (ADO Hook -> Gateway -> Orchestrator -> Agents -> Neon/Redis).
- **Deployment View**: `docs/architecture/assets/deployment.png` (AKS Clusters, Namespaces, Neon, Redis HA, Edge).

Artefakte werden ueber `npm run c4:export` generiert und im Docs-Portal veroeffentlicht. Jede Freigabe enthaelt Sign-off (Architecture Board) und Evidence-Link in `governance/governance.md`. Hash-Werte der PNGs werden in Neon `architecture.assets` gespeichert, um Integrity sicherzustellen.

### System Context Summary
- Akteure: Azure DevOps, Entwickler, Tenant Owner, Support.
- Systeme: Gateway (Traefik), Orchestrator, Monitoring Stack, Data Layer (Neon/Redis), External LLM Provider.
- Beziehungen: Webhooks von ADO treffen im Gateway ein, Orchestrator dispatcht Agenten, Monitoring Stack liefert Feedback.

### Container View Highlights
- Gateway Container (TypeScript) mit Auth, Rate Limit, Webhook Handler.
- Orchestrator Container (TypeScript) mit Task Scheduler, Redis Streams, Neon State.
- Monitoring Container (Prometheus Operator Stack) fuer Metriken/Alerts.
- Integration Container (Adapters fuer ADO/GitHub/GitLab) und Docs Generator.

### Dynamic View: Draft PR Flow
1. ADO Service Hook -> Gateway `/webhooks/ado` (HMAC Validierung).
2. Gateway uebergibt Task an Orchestrator (Redis Stream `agent.tasks`).
3. Orchestrator resolved Kontext aus Neon/Redis und ruft Dev-Agent an.
4. Dev-Agent erstellt Branch/Draft-PR, ruft Task Agent fuer Tests.
5. Ergebnisse landen im Ledger (Neon) und werden ueber Monitoring gemessen.
6. Health Monitor setzt Status, Alertmanager triggert falls SLO verletzt.

### Deployment View Highlights
- AKS Region EU-West, Namespaces: core, agents, observability, tenants.
- Argo CD App-of-Apps verwaltet Deployments, cert-manager fuer TLS.
- Neon (managed) in Primary Region, Geo-Replica secondary.
- Redis Cluster (Operator) mit Sentinel und PodDisruptionBudgets.

## Offene Punkte & Abhaengigkeiten
- Abstimmung mit Frontend/Integration Teams ueber Komponenten-Detailgrad.
- Automatisierte Validierung gegen Live Config (Drift Detection).
- Integration in Governance Dashboard fuer Architektur-Abweichungen.
- Abhaengigkeit zu ADR Maintenance.

## Links
- [ADR Index](md.html?path=adr/README.md)
- [Core Plattform](md.html?path=core/core.md)
- [Deployment Strategy](md.html?path=deployment/deployment.md)
- [Operations Runbooks](md.html?path=operations/operations.md)



